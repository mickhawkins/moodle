{{!
    This file is part of Moodle - http://moodle.org/

    Moodle is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    Moodle is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with Moodle.  If not, see <http://www.gnu.org/licenses/>.
}}
{{!
    @template report_security/security_report_section_results

    Template for populating results of a section of the security report.

    Classes required for JS:
    * None

    Data attributes required for JS:
    * None

    Context variables required for this template:
    * issue         The name of the issue
    * link          Local link to further issue information
    * level         The risk level of the result
    * description   Description of the current risk

    Example context (json):
    {
        "sectionid": 1,
        "issues": [
            {
                "position":     "1",
                "issue":        "Password policy",
                "linkparam":    "report_security_check_passwordpolicy",
                "status":        "critical",
                "description":  "Password policy not set."
            }
        ],
        "passedcount": 1,
        "passed": [
            {
                "position":     "1",
                "issue":        "Insecure dataroot",
                "linkparam":    "report_security_check_unsecuredataroot",
                "status":        "ok",
                "statusname":
                "description":  "Dataroot directory must not be accessible via the web."
            }
        ]
    }
}}

<tbody data-reportsection="{{sectionid}}">
    {{#issues}}
    <tr>
        <td><a href="index.php?issue={{linkparam}}">{{issue}}</a></td>
        <td><span class="status{{status}}">{{statusname}}</span></td>
        <td>{{description}}</td>
    </tr>
    {{/issues}}
    <tr>
        <td colspan="3">
            {{passedcount}} checks require no action
            <button id="togglepassedsection{{sectionid}}" class="btn btn-link" aria-expanded="false">Click to show passed checks</button>
        </td>
    </tr>
</tbody>
<tbody data-passedsection="{{sectionid}}" class="hidden">
    {{#passed}}
    <tr>
        <td><a href="index.php?issue={{linkparam}}">{{issue}}</a></td>
        <td><span class="status{{level}}">{{level}}</span></td>
        <td>{{description}}</td>
    </tr>
    {{/passed}}
</tbody>

{{#js}}

//TODO: Move this to separate file, that has the sectionid passed in

    document.getElementById('togglepassedsection{{sectionid}}').onclick = () => {
        const passedsection = document.querySelector('[data-passedsection="{{sectionid}}"]');
        const togglebutton = document.getElementById('togglepassedsection{{sectionid}}');

        passedsection.classList.toggle('hidden');

        //todo Below here doesnt work

        if (togglebutton.getAttribute('aria-expanded') === true) {
            togglebutton.setAttribute('aria-expanded', true);
            document.getElementById('blah').innerText = "Click to hide passed checks";
        } else {
            togglebutton.setAttribute('aria-expanded', false);
            document.getElementById('blah').innerText = "Click to show passed checks";
        }
    };

{{/js}}
