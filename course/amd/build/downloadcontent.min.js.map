{"version":3,"sources":["../src/downloadcontent.js"],"names":["prepareDownloadContentModal","downloadTrigger","downloadLink","attr","downloadModalTitle","downloadModalBody","downloadModalSubmitText","ModalFactory","create","title","type","types","SAVE_CANCEL","body","done","modal","setSaveButtonText","getRoot","on","ModalEvents","save","downloadForm","document","createElement","action","method","target","downloadSesskey","name","value","M","cfg","sesskey","appendChild","style","display","submit","removeChild"],"mappings":"4fAwBA,OACA,OACA,uD,siBAOO,GAAMA,CAAAA,CAA2B,CAAG,UAAM,IACvCC,CAAAA,CAAe,CAAG,cAAE,yBAAF,CADqB,CAEvCC,CAAY,CAAGD,CAAe,CAACE,IAAhB,CAAqB,oBAArB,CAFwB,CAGvCC,CAAkB,CAAGH,CAAe,CAACE,IAAhB,CAAqB,qBAArB,CAHkB,CAIvCE,CAAiB,CAAG,MAAQJ,CAAe,CAACE,IAAhB,CAAqB,oBAArB,CAAR,CAAqD,MAJlC,CAKvCG,CAAuB,CAAGL,CAAe,CAACE,IAAhB,CAAqB,2BAArB,CALa,CAO7CI,CAAY,CAACC,MAAb,CAAoB,CAChBC,KAAK,CAAEL,CADS,CAEhBM,IAAI,CAAEH,CAAY,CAACI,KAAb,CAAmBC,WAFT,CAGhBC,IAAI,CAAER,CAHU,CAApB,CAIGJ,CAJH,EAKCa,IALD,CAKM,SAASC,CAAT,CAAgB,CAClBA,CAAK,CAACC,iBAAN,CAAwBV,CAAxB,EAGAS,CAAK,CAACE,OAAN,GAAgBC,EAAhB,CAAmBC,CAAW,CAACC,IAA/B,CAAqC,UAAW,CAE5C,GAAIC,CAAAA,CAAY,CAAGC,QAAQ,CAACC,aAAT,CAAuB,MAAvB,CAAnB,CACAF,CAAY,CAACG,MAAb,CAAsBtB,CAAtB,CACAmB,CAAY,CAACI,MAAb,CAAsB,MAAtB,CAEAJ,CAAY,CAACK,MAAb,CAAsB,QAAtB,CACA,GAAIC,CAAAA,CAAe,CAAGL,QAAQ,CAACC,aAAT,CAAuB,OAAvB,CAAtB,CACAI,CAAe,CAACC,IAAhB,CAAuB,SAAvB,CACAD,CAAe,CAACE,KAAhB,CAAwBC,CAAC,CAACC,GAAF,CAAMC,OAA9B,CACAX,CAAY,CAACY,WAAb,CAAyBN,CAAzB,EACAN,CAAY,CAACa,KAAb,CAAmBC,OAAnB,CAA6B,MAA7B,CAEAb,QAAQ,CAACT,IAAT,CAAcoB,WAAd,CAA0BZ,CAA1B,EACAA,CAAY,CAACe,MAAb,GACAd,QAAQ,CAACT,IAAT,CAAcwB,WAAd,CAA0BhB,CAA1B,CACH,CAhBD,CAiBH,CA1BD,CA2BH,CAlCM,C","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Functions related to downloading course content.\n *\n * @module     core_course/downloadcontent\n * @package    core_course\n * @copyright  2020 Michael Hawkins <michaelh@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport * as ModalFactory from 'core/modal_factory';\nimport * as ModalEvents from 'core/modal_events';\nimport $ from 'jquery';\n\n/**\n * Prepare the content and behaviour of the course download content modal.\n *\n * @return {void}\n */\nexport const prepareDownloadContentModal = () => {\n    const downloadTrigger = $('[data-downloadcourse=1]');\n    const downloadLink = downloadTrigger.attr('data-download-link');\n    const downloadModalTitle = downloadTrigger.attr('data-download-title');\n    const downloadModalBody = '<p>' + downloadTrigger.attr('data-download-body') + '</p>';\n    const downloadModalSubmitText = downloadTrigger.attr('data-download-button-text');\n\n    ModalFactory.create({\n        title: downloadModalTitle,\n        type: ModalFactory.types.SAVE_CANCEL,\n        body: downloadModalBody\n    }, downloadTrigger)\n    .done(function(modal) {\n        modal.setSaveButtonText(downloadModalSubmitText);\n\n        // Trigger the download when the \"Download\" button is pressed.\n        modal.getRoot().on(ModalEvents.save, function() {\n            // Create a form to submit the file download request, so we can avoid sending sesskey over GET.\n            var downloadForm = document.createElement('form');\n            downloadForm.action = downloadLink;\n            downloadForm.method = 'POST';\n            // Open download in a new tab, so current course view is not disrupted.\n            downloadForm.target = '_blank';\n            var downloadSesskey = document.createElement('input');\n            downloadSesskey.name = 'sesskey';\n            downloadSesskey.value = M.cfg.sesskey;\n            downloadForm.appendChild(downloadSesskey);\n            downloadForm.style.display = 'none';\n\n            document.body.appendChild(downloadForm);\n            downloadForm.submit();\n            document.body.removeChild(downloadForm);\n        });\n    });\n};\n"],"file":"downloadcontent.min.js"}