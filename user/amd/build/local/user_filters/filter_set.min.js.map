{"version":3,"sources":["../../../src/local/user_filters/filter_set.js"],"names":["submitFilters","filterSetDiv","filterSet","querySelectorAll","forEach","filterRow","uniqid","getAttribute","joinType","document","getElementById","Selectors","filters","row","filterType","filterValuesDiv","querySelector","enhancedValuesClass","filterValues","length","filterObj","filterValueItem","filtervalues","push","window","console","log","clearFilters","firstFilter","addCondition","filterSetUniqid","userFiltersDiv","filterset","userFilters","baseFilterData","baseData","joinTypesDefault","JSON","parse","filterTypesDefault","context","value","label","Templates","render","then","html","js","appendNodeContents","fail","Notification","exception","init","submit","addEventListener","clearAll"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Module responsible for submitting any participants filters that have been applied.\n *\n * @module     core_user/local/user_filter/filter_set\n * @package    core_user\n * @copyright  2020 Michael Hawkins <michaelh@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Notification from 'core/notification';\nimport {resetFilterRow} from './reset_row';\nimport Selectors from './selectors';\nimport Templates from 'core/templates';\n\n// Submit filter values in the filter set.\nconst submitFilters = (filterSetDiv) => {\n    const filterSet = [];\n\n    // Prepare data from each filter in the filter set to submit.\n    filterSetDiv.querySelectorAll('[data-filter-uniqid]').forEach((filterRow) => {\n        let uniqid = filterRow.getAttribute('data-filter-uniqid');\n        let joinType = document.getElementById(Selectors.filters.row.joinType(uniqid)).getAttribute('data-option-selected');\n        let filterType = document.getElementById(Selectors.filters.row.filterType(uniqid)).getAttribute('data-option-selected');\n        let filterValuesDiv = filterRow.querySelector(Selectors.filters.row.enhancedValuesClass);\n\n        // Include any filters that have values set.\n        if (filterValuesDiv !== null) {\n            let filterValues = filterValuesDiv.querySelectorAll('span[role=\"listitem\"]');\n\n            if (filterValues.length > 0) {\n                let filterObj = {\n                    \"jointype\": joinType,\n                    \"filtertype\": filterType,\n                    \"filtervalues\": []\n                };\n\n                filterValues.forEach((filterValueItem) => {\n                    filterObj.filtervalues.push(filterValueItem.getAttribute('data-value'));\n                });\n\n                filterSet.push(filterObj);\n            }\n        }\n    });\n\n    // TEMP: Output the applied filters until there's somewhere to AJAX the request to.\n    window.console.log(filterSet);\n};\n\n// Clear all values in the filter set, leaving a single default filter.\nconst clearFilters = (filterSetDiv) => {\n    const firstFilter = filterSetDiv.querySelector('[data-filter-uniqid]');\n    const uniqid = firstFilter.getAttribute('data-filter-uniqid');\n\n    // Clear data from first filter to return it to default.\n    resetFilterRow(uniqid);\n\n    // Remove all other filter rows.\n    // TODO when more than one filter row can exist.\n};\n\n// Add a new condition (filter row) to the filter set.\nconst addCondition = (filterSetUniqid) => {\n    const userFiltersDiv = document.getElementById(Selectors.filterset.userFilters(filterSetUniqid));\n    const baseFilterData = document.getElementById(Selectors.filterset.baseData(filterSetUniqid));\n    const joinTypesDefault = JSON.parse(baseFilterData.getAttribute('data-join-types-default'));\n    const filterTypesDefault = JSON.parse(baseFilterData.getAttribute('data-filter-types-default'));\n\n    const context = {\n        \"jointypes\": JSON.parse(baseFilterData.getAttribute('data-join-types')),\n        \"jointypesdefaultvalue\": joinTypesDefault.value,\n        \"jointypesdefaultlabel\": joinTypesDefault.label,\n        \"filtertypes\": JSON.parse(baseFilterData.getAttribute('data-filter-types')),\n        \"filtertypesdefaultvalue\": filterTypesDefault.value,\n        \"filtertypesdefaultlabel\": filterTypesDefault.label\n    };\n\n    Templates.render('core_user/user_filter_row', context)\n        .then((html, js) => {\n            Templates.appendNodeContents(userFiltersDiv, html, js);\n        })\n        .fail(Notification.exception);\n};\n\n// Initialise handlers in the filter set.\nexport const init = uniqid => {\n    const filterSetDiv = document.getElementById(`${uniqid}-user-filterset`);\n\n    document.getElementById(Selectors.filterset.submit(uniqid)).addEventListener('click', () => {\n        submitFilters(filterSetDiv);\n    });\n\n    document.getElementById(Selectors.filterset.clearAll(uniqid)).addEventListener('click', () => {\n        clearFilters(filterSetDiv);\n    });\n\n    document.getElementById(Selectors.filterset.addCondition(uniqid)).addEventListener('click', () => {\n        addCondition(uniqid);\n    });\n};\n"],"file":"filter_set.min.js"}