{"version":3,"sources":["../../../src/local/user_filters/filter_set.js"],"names":["submitFilters","filterSetDiv","filterSet","querySelectorAll","forEach","filterRow","uniqid","getAttribute","matchType","document","getElementById","Selectors","filters","row","filterType","filterValuesDiv","querySelector","enhancedValuesClass","filterValues","length","filterObj","filterValueItem","filtervalues","push","window","console","log","clearFilters","firstFilter","init","addEventListener"],"mappings":"sLAyBA,uD,GAIMA,CAAAA,CAAa,CAAG,SAACC,CAAD,CAAkB,CACpC,GAAMC,CAAAA,CAAS,CAAG,EAAlB,CAGAD,CAAY,CAACE,gBAAb,CAA8B,sBAA9B,EAAsDC,OAAtD,CAA8D,SAACC,CAAD,CAAe,IACrEC,CAAAA,CAAM,CAAGD,CAAS,CAACE,YAAV,CAAuB,oBAAvB,CAD4D,CAErEC,CAAS,CAAGC,QAAQ,CAACC,cAAT,CAAwBC,UAAUC,OAAV,CAAkBC,GAAlB,CAAsBL,SAAtB,CAAgCF,CAAhC,CAAxB,EAAiEC,YAAjE,CAA8E,sBAA9E,CAFyD,CAGrEO,CAAU,CAAGL,QAAQ,CAACC,cAAT,CAAwBC,UAAUC,OAAV,CAAkBC,GAAlB,CAAsBC,UAAtB,CAAiCR,CAAjC,CAAxB,EAAkEC,YAAlE,CAA+E,sBAA/E,CAHwD,CAIrEQ,CAAe,CAAGV,CAAS,CAACW,aAAV,CAAwBL,UAAUC,OAAV,CAAkBC,GAAlB,CAAsBI,mBAA9C,CAJmD,CAOzE,GAAwB,IAApB,GAAAF,CAAJ,CAA8B,CAC1B,GAAIG,CAAAA,CAAY,CAAGH,CAAe,CAACZ,gBAAhB,CAAiC,yBAAjC,CAAnB,CAEA,GAA0B,CAAtB,CAAAe,CAAY,CAACC,MAAjB,CAA6B,CACzB,GAAIC,CAAAA,CAAS,CAAG,CACZ,UAAaZ,CADD,CAEZ,WAAcM,CAFF,CAGZ,aAAgB,EAHJ,CAAhB,CAMAI,CAAY,CAACd,OAAb,CAAqB,SAACiB,CAAD,CAAqB,CACtCD,CAAS,CAACE,YAAV,CAAuBC,IAAvB,CAA4BF,CAAe,CAACd,YAAhB,CAA6B,YAA7B,CAA5B,CACH,CAFD,EAIAL,CAAS,CAACqB,IAAV,CAAeH,CAAf,CACH,CACJ,CACJ,CAxBD,EA2BAI,MAAM,CAACC,OAAP,CAAeC,GAAf,CAAmBxB,CAAnB,CACH,C,CAGKyB,CAAY,CAAG,SAAC1B,CAAD,CAAkB,IAC7B2B,CAAAA,CAAW,CAAG3B,CAAY,CAACe,aAAb,CAA2B,sBAA3B,CADe,CAE7BV,CAAM,CAAGsB,CAAW,CAACrB,YAAZ,CAAyB,oBAAzB,CAFoB,CAKnC,qBAAeD,CAAf,CAIH,C,QAGmB,QAAPuB,CAAAA,IAAO,CAAAvB,CAAM,CAAI,CAC1B,GAAML,CAAAA,CAAY,CAAGQ,QAAQ,CAACC,cAAT,WAA2BJ,CAA3B,kBAArB,CAEAG,QAAQ,CAACC,cAAT,WAA2BJ,CAA3B,aAA4CwB,gBAA5C,CAA6D,OAA7D,CAAsE,UAAU,CAC5E9B,CAAa,CAACC,CAAD,CAChB,CAFD,EAIAQ,QAAQ,CAACC,cAAT,WAA2BJ,CAA3B,eAA8CwB,gBAA9C,CAA+D,OAA/D,CAAwE,UAAU,CAC9EH,CAAY,CAAC1B,CAAD,CACf,CAFD,CAGH,C","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Module responsible for submitting any participants filters that have been applied.\n *\n * @module     core_user/local/user_filter/filter_set\n * @package    core_user\n * @copyright  2020 Michael Hawkins <michaelh@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n//import Autocomplete from 'core/form-autocomplete';\nimport Selectors from './selectors';\nimport {resetFilterRow} from './reset_row';\n\n// Submit filter values in the filter set.\nconst submitFilters = (filterSetDiv) => {\n    const filterSet = [];\n\n    // Prepare data from each filter in the filter set to submit.\n    filterSetDiv.querySelectorAll('[data-filter-uniqid]').forEach((filterRow) => {\n        let uniqid = filterRow.getAttribute('data-filter-uniqid');\n        let matchType = document.getElementById(Selectors.filters.row.matchType(uniqid)).getAttribute('data-option-selected');\n        let filterType = document.getElementById(Selectors.filters.row.filterType(uniqid)).getAttribute('data-option-selected');\n        let filterValuesDiv = filterRow.querySelector(Selectors.filters.row.enhancedValuesClass);\n\n        // Include any filters that have values set.\n        if (filterValuesDiv !== null) {\n            let filterValues = filterValuesDiv.querySelectorAll('span[role=\"listitem\"]');\n\n            if (filterValues.length > 0) {\n                let filterObj = {\n                    \"matchtype\": matchType,\n                    \"filtertype\": filterType,\n                    \"filtervalues\": []\n                };\n\n                filterValues.forEach((filterValueItem) => {\n                    filterObj.filtervalues.push(filterValueItem.getAttribute('data-value'));\n                });\n\n                filterSet.push(filterObj);\n            }\n        }\n    });\n\n    // TEMP: Output the applied filters until there's somewhere to AJAX the request to.\n    window.console.log(filterSet);\n};\n\n// Clear all values in the filter set, leaving a single default filter.\nconst clearFilters = (filterSetDiv) => {\n    const firstFilter = filterSetDiv.querySelector('[data-filter-uniqid]');\n    const uniqid = firstFilter.getAttribute('data-filter-uniqid');\n\n    // Clear data from first filter to return it to default.\n    resetFilterRow(uniqid);\n\n    // Remove all other filter rows.\n    // TODO when more than one filter row can exist.\n};\n\n// Initialise handlers in the filter set.\nexport const init = uniqid => {\n    const filterSetDiv = document.getElementById(`${uniqid}-user-filters`);\n\n    document.getElementById(`${uniqid}-submit`).addEventListener('click', function(){\n        submitFilters(filterSetDiv);\n    });\n\n    document.getElementById(`${uniqid}-clearall`).addEventListener('click', function(){\n        clearFilters(filterSetDiv);\n    });\n};\n"],"file":"filter_set.min.js"}